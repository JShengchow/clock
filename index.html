<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,
        initial-scale=1.0" />
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- Import style -->
  <link rel="stylesheet" href="//unpkg.com/element-plus/dist/index.css" />
  <!-- Import component library -->
  <script src="//unpkg.com/element-plus"></script>
  <title>Hard Work Clock</title>

  <style>
    .clock-current {
      position: fixed;
      right: 0;
      top: 0;
    }

    .clock-set {
      display: flex;
      flex-wrap: wrap;
    }

    .clock-countdown {
      font-size: 180px;
      font-weight: 500;
      margin: 100px auto 0;
      text-align: center;
      border: 2px solid black;
      border-radius: 20px;
    }

    .clock-cust {
      /* display: inline-flex; */
      align-items: center;
    }

    .clock-btn {
      margin-right: 40px;
    }

    .el-input-number {
      width: 120px;
      margin: 12px;
    }

    .cust-dialog {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>

<body>

  <div id="app">
    <div class="clock-set">
      <el-button @click="handleSetTime(5405,13, 59, 55 )" :disabled="isCoundown" type="primary">行测时间</el-button>
      <el-button @click="handleSetTime(7205, 16, 14, 55 )" :disabled="isCoundown" type="primary">申论时间</el-button>
      <el-button @click="handleReset()" type="primary"  :disabled="!isCoundown" plain>重置</el-button>
      <el-button :disabled="isCoundown" @click="()=> visible= true">指定时间</el-button>
    </div>

    <div class="clock-countdown">
      {{ countdown.displayTime() }}
    </div>

    <div class="clock-current">
      {{ currentClock.displayTime() }}
    </div>
    <el-dialog v-model="visible" title="开始时间" center align-center>
      <div class="cust-dialog">
        <div>
          <el-input-number v-model.number="custHour" :min='0' :max="24"></el-input-number>时
        </div>
        <div>
          <el-input-number v-model.number="custMinute" :min='0' :max="60"></el-input-number>分
        </div>
        <div>
          <el-input-number v-model.number="custSecond" :min='0' :max="60"></el-input-number>秒
        </div>
        <div>
          时长
          <el-input-number  v-model.number="custDuration" :min='0' ></el-input-number>
          秒
        </div>
      </div>
      <template  #footer>
        <el-button type="primary" @click="handleSetTime(custDuration,custHour, custMinute,custSecond)">确定</el-button>
      </template>
    </el-dialog>
  </div>

  <script>
    const { createApp, ref } = Vue
    const { ElMessage, ElMessageBox } = ElementPlus
    const app = createApp({
      setup() {
        class Clock {
          constructor(durationInSeconds, startHour = null, startMinute = null, startSecond = null) {
            if (startHour !== null && startMinute !== null && startSecond !== null) {
              const now = new Date();
              this.startTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), startHour, startMinute, startSecond).getTime();
            } else {
              this.startTime = Date.now();
            }
            this.endTime = Date.now() + (durationInSeconds * 1000);
            this.localActualTime = Date.now();
            this.elapsedTime = 0;
            this.timerID = null;
          }

          start(cb) {
            this.elapsedTime = Date.now() - this.localActualTime;
            this.timerID = setInterval(() => {
              this.elapsedTime = Date.now() - this.localActualTime;
              if (Date.now() >= this.endTime) {
                this.pause();
                cb()
              }
            }, 500);
          }

          pause() {
            clearInterval(this.timerID);
          }

          reset() {
            clearInterval(this.timerID);
            this.elapsedTime = 0;
          }

          displayTime() {
            const currentDisplayTime = new Date(this.startTime + this.elapsedTime)
            const hours = currentDisplayTime.getHours();
            const minutes = currentDisplayTime.getMinutes();
            const seconds = currentDisplayTime.getSeconds();
            return `${this.formatTime(hours)} : ${this.formatTime(minutes)} : ${this.formatTime(seconds)}`;
          }

          formatTime(value) {
            return value.toString().padStart(2, '0');
          }
        }
        // 当前时间
        const currentClock = ref(new Clock(86400))
        currentClock.value.start()
        // 指定时间
        let timerCount = null
        const countdown = ref(new Clock(5400, 13, 59, 50))
        const isCoundown = ref(false)
        const handleSetTime = (duration, hour, minutes, seconds) => {
          ElMessage.warning('即将开始')
          visible.value = false
          isCoundown.value = true
          // 启动时钟
          countdown.value = new Clock(duration, hour, minutes, seconds)
          countdown.value.start(() => {
            ElMessageBox.alert('时间到啦！！！', '时间到', {
              confirmButtonText: '做完啦！！！',
              callback: () => {
                countdown.value.reset()
                isCoundown.value = false
              }
            })
          })
        }

        const handleReset = () => {
          isCoundown.value = false
          countdown.value.reset()
        }

        const custHour = ref(null)
        const custMinute = ref(null)
        const custSecond = ref(null)
        const custDuration = ref(null)
        const visible = ref(false)
        return {
          currentClock,
          countdown,
          isCoundown,
          custHour,
          custMinute,
          custSecond,
          custDuration,
          visible,
          handleSetTime,
          handleReset,
        }
      }
    }).use(ElementPlus).mount('#app')
  </script>

</body>

</html>